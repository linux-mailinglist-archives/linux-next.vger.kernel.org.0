Return-Path: <linux-next-owner@vger.kernel.org>
X-Original-To: lists+linux-next@lfdr.de
Delivered-To: lists+linux-next@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 6B63A97476
	for <lists+linux-next@lfdr.de>; Wed, 21 Aug 2019 10:13:19 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726739AbfHUINR (ORCPT <rfc822;lists+linux-next@lfdr.de>);
        Wed, 21 Aug 2019 04:13:17 -0400
Received: from foss.arm.com ([217.140.110.172]:54072 "EHLO foss.arm.com"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1726513AbfHUINR (ORCPT <rfc822;linux-next@vger.kernel.org>);
        Wed, 21 Aug 2019 04:13:17 -0400
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
        by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 6B1AB337;
        Wed, 21 Aug 2019 01:13:16 -0700 (PDT)
Received: from big-swifty.misterjones.org (unknown [10.1.39.37])
        by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 1553B3F246;
        Wed, 21 Aug 2019 01:13:14 -0700 (PDT)
Date:   Wed, 21 Aug 2019 09:13:15 +0100
Message-ID: <86zhk3lyw4.wl-marc.zyngier@arm.com>
From:   Marc Zyngier <marc.zyngier@arm.com>
To:     Stephen Rothwell <sfr@canb.auug.org.au>
Cc:     Linus Walleij <linus.walleij@linaro.org>,
        Linux Next Mailing List <linux-next@vger.kernel.org>,
        Linux Kernel Mailing List <linux-kernel@vger.kernel.org>
Subject: Re: linux-next: manual merge of the gpio tree with the irqchip tree
In-Reply-To: <20190821160335.09071cb5@canb.auug.org.au>
References: <20190821160335.09071cb5@canb.auug.org.au>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 EasyPG/1.0.0 Emacs/26
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-next-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-next.vger.kernel.org>
X-Mailing-List: linux-next@vger.kernel.org

On Wed, 21 Aug 2019 07:03:35 +0100,
Stephen Rothwell <sfr@canb.auug.org.au> wrote:

Hi Stephen,

> 
> Hi all,
> 
> Today's linux-next merge of the gpio tree got a conflict in:
> 
>   drivers/gpio/gpio-ixp4xx.c
> 
> between commit:
> 
>   daa19fe5b082 ("gpio/ixp4xx: Register the base PA instead of its VA in fwnode")
> 
> from the irqchip tree and commit:
> 
>   aa7d618ac65f ("gpio: ixp4xx: Convert to hierarchical GPIOLIB_IRQCHIP")
> 
> from the gpio tree.
> 
> I fixed it up (see below) and can carry the fix as necessary. This
> is now fixed as far as linux-next is concerned, but any non trivial
> conflicts should be mentioned to your upstream maintainer when your tree
> is submitted for merging.  You may also want to consider cooperating
> with the maintainer of the conflicting tree to minimise any particularly
> complex conflicts.
> 
> -- 
> Cheers,
> Stephen Rothwell
> 
> diff --cc drivers/gpio/gpio-ixp4xx.c
> index cc72c9aca5a1,8bd23e80c61f..000000000000
> --- a/drivers/gpio/gpio-ixp4xx.c
> +++ b/drivers/gpio/gpio-ixp4xx.c
> @@@ -326,6 -209,35 +209,35 @@@ static int ixp4xx_gpio_probe(struct pla
>   		return PTR_ERR(g->base);
>   	}
>   
> + 	/*
> + 	 * When we convert to device tree we will simply look up the
> + 	 * parent irqdomain using irq_find_host(parent) as parent comes
> + 	 * from IRQCHIP_DECLARE(), then use of_node_to_fwnode() to get
> + 	 * the fwnode. For now we need this boardfile style code.
> + 	 */
> + 	if (np) {
> + 		struct device_node *irq_parent;
> + 
> + 		irq_parent = of_irq_find_parent(np);
> + 		if (!irq_parent) {
> + 			dev_err(dev, "no IRQ parent node\n");
> + 			return -ENODEV;
> + 		}
> + 		parent = irq_find_host(irq_parent);
> + 		if (!parent) {
> + 			dev_err(dev, "no IRQ parent domain\n");
> + 			return -ENODEV;
> + 		}
> + 		g->fwnode = of_node_to_fwnode(np);
> + 	} else {
> + 		parent = ixp4xx_get_irq_domain();
>  -		g->fwnode = irq_domain_alloc_fwnode(g->base);
> ++		g->fwnode = irq_domain_alloc_fwnode(&res->start);
> + 		if (!g->fwnode) {
> + 			dev_err(dev, "no domain base\n");
> + 			return -ENODEV;
> + 		}
> + 	}
> + 
>   	/*
>   	 * Make sure GPIO 14 and 15 are NOT used as clocks but GPIO on
>   	 * specific machines.

Looks good, thanks for fixing this.

Linus: do you want to take this patch (daa19fe5b082) through your tree
instead in order to avoid the conflict when this hit the other Linus?
It shouldn't create any havoc...

Just let me know.

	M.

-- 
Jazz is not dead, it just smells funny.
